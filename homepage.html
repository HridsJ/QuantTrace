<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analyzer Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="assets/homepage_style.css" rel="stylesheet">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h1>Stock Analyzer Pro</h1>
                <div id="loginForm">
                    <input type="email" id="email" placeholder="Email address">
                    <input type="password" id="password" placeholder="Password">
                    <button onclick="login()">Sign In</button>
                    <button onclick="register()">Create Account</button>
                    <button class="guest-btn" onclick="guestLogin()">Continue as Guest</button>
                </div>
                <div id="loginMessage"></div>
            </div>
        </div>
    </div>

    <!-- Stock Selection Page -->
    <div id="stockPage" class="page">
        <button class="nav-btn back-btn" onclick="logout()">Logout</button>
        <button class="nav-btn" onclick="showGraphsPage()">Performance →</button>
        <div class="container">
            <h1>My Stock Portfolio</h1>
            <div class="add-stock">
                <input type="text" id="newStock" placeholder="Enter stock ticker (e.g., AAPL, GOOGL, TSLA)">
                <button onclick="addStock()">Add Stock</button>
            </div>
            <div id="stockList" class="stock-list"></div>
            
            <h2 style="margin-top: 50px; margin-bottom: 20px;">Analysis Filters</h2>
            <div class="filter-buttons">
                <button class="filter-btn" onclick="showFilterPage('revenue')">
                    <div class="title">5-Year Revenue Growth</div>
                    <div class="description">Analyze revenue growth trends and compound annual growth rates</div>
                </button>
                <button class="filter-btn" onclick="showFilterPage('pe')">
                    <div class="title">Price-to-Earnings (P/E)</div>
                    <div class="description">Compare P/E ratios and valuation metrics across stocks</div>
                </button>
                <button class="filter-btn" onclick="showFilterPage('debt')">
                    <div class="title">Debt-to-Equity</div>
                    <div class="description">Evaluate financial leverage and debt management</div>
                </button>
                <button class="filter-btn" onclick="showFilterPage('volume')">
                    <div class="title">Relative Volume</div>
                    <div class="description">Monitor trading volume patterns and market interest</div>
                </button>
                <button class="filter-btn" onclick="showFilterPage('moving')">
                    <div class="title">50-Day / 200-Day MA</div>
                    <div class="description">Track moving average crossovers and trend signals</div>
                </button>
            </div>
            
            <div id="stockMessage"></div>
        </div>
    </div>

    <!-- Performance Graphs Page -->
    <div id="graphsPage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage()">Pattern Analysis →</button>
        <div class="container">
            <h1>5-Year Performance Analysis</h1>
            <div id="graphsContainer"></div>
            <div id="graphsMessage"></div>
        </div>
    </div>

    <!-- Filter Analysis Pages -->
    <div id="revenuePage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage('revenue')">Create Pattern →</button>
        <div class="container">
            <h1>5-Year Revenue Growth Analysis</h1>
            <div id="revenueStats" class="filter-stats"></div>
            <div id="revenueCharts"></div>
        </div>
    </div>

    <div id="pePage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage('pe')">Create Pattern →</button>
        <div class="container">
            <h1>Price-to-Earnings (P/E) Analysis</h1>
            <div id="peStats" class="filter-stats"></div>
            <div id="peCharts"></div>
        </div>
    </div>

    <div id="debtPage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage('debt')">Create Pattern →</button>
        <div class="container">
            <h1>Debt-to-Equity Analysis</h1>
            <div id="debtStats" class="filter-stats"></div>
            <div id="debtCharts"></div>
        </div>
    </div>

    <div id="volumePage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage('volume')">Create Pattern →</button>
        <div class="container">
            <h1>Relative Volume Analysis</h1>
            <div id="volumeStats" class="filter-stats"></div>
            <div id="volumeCharts"></div>
        </div>
    </div>

    <div id="movingPage" class="page">
        <button class="nav-btn back-btn" onclick="showStockPage()">← Back</button>
        <button class="nav-btn" onclick="showPatternPage('moving')">Create Pattern →</button>
        <div class="container">
            <h1>Moving Average Analysis</h1>
            <div id="movingStats" class="filter-stats"></div>
            <div id="movingCharts"></div>
        </div>
    </div>

    <!-- Pattern Creation Page -->
    <div id="patternPage" class="page">
        <button class="nav-btn back-btn" onclick="goBackFromPattern()">← Back</button>
        <button class="nav-btn" onclick="analyzePattern()">Analyze Pattern</button>
        <div class="container">
            <h1>Create Pattern</h1>
            <p style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.7); text-align: center;">Click on the canvas to create data points, then connect them to form your pattern:</p>
            <div class="pattern-canvas-container">
                <canvas id="patternCanvas" class="pattern-canvas" width="800" height="400"></canvas>
            </div>
            <div class="pattern-controls">
                <button onclick="clearPattern()">Clear Pattern</button>
                <button onclick="connectPoints()">Connect Points</button>
            </div>
            <div id="patternMessage"></div>
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="page">
        <button class="nav-btn back-btn" onclick="showPatternPage()">← Back</button>
        <div class="container">
            <h1>Pattern Matches</h1>
            <div id="resultsContainer" class="results-grid"></div>
            <div id="resultsMessage"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "demo-key" };
        let currentUser = null;
        let userStocks = [];
        let patternPoints = [];
        let isConnecting = false;
        let pageHistory = [];

        const demoStockData = {
        'AAPL': generateMockData(),
        'GOOGL': generateMockData(),
        'TSLA': generateMockData(),
        'MSFT': generateMockData(),
        'AMZN': generateMockData(),
        'NVDA': generateMockData(),
        'META': generateMockData(),
        'NFLX': generateMockData()
        };

        function generateMockData() {
        const data = [];
        let base = 100 + Math.random() * 200;
        for (let i = 0; i < 60; i++) {
            base += (Math.random() - 0.5) * 20;
            base = Math.max(50, base);
            data.push({ date: new Date(2019 + Math.floor(i/12), i%12, 1), value: base });
        }
        return data;
        }

        // AUTH
        function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password) return showMessage('loginMessage', 'Please enter email and password', 'error');
        currentUser = { email, uid: 'demo-user-' + Date.now() };
        userStocks = ['AAPL', 'GOOGL', 'TSLA'];
        showMessage('loginMessage', 'Login successful!', 'success');
        setTimeout(() => showStockPage(), 1000);
        }

        function register() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password) return showMessage('loginMessage', 'Please enter email and password', 'error');
        currentUser = { email, uid: 'demo-user-' + Date.now() };
        userStocks = [];
        showMessage('loginMessage', 'Account created successfully!', 'success');
        setTimeout(() => showStockPage(), 1000);
        }

        function guestLogin() {
        currentUser = { email: 'guest@demo.com', uid: 'guest-user' };
        userStocks = ['AAPL', 'GOOGL', 'TSLA', 'MSFT', 'AMZN'];
        showMessage('loginMessage', 'Continuing as guest...', 'success');
        setTimeout(() => showStockPage(), 1000);
        }

        function logout() {
        currentUser = null;
        userStocks = [];
        showPage('loginPage');
        }

        // PAGE NAVIGATION
        function showPage(pageId) {
        const current = document.querySelector('.page.active');
        if (current && current.id !== pageId) pageHistory.push(current.id);
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        }

        function goBack() {
        if (pageHistory.length > 0) {
            const last = pageHistory.pop();
            showPage(last);
        }
        }

        function goBackFromPattern() {
        goBack();
        }

        function showStockPage() {
        showPage('stockPage');
        loadUserStocks();
        }

        function showGraphsPage() {
        showPage('graphsPage');
        loadGraphs();
        }

        function showPatternPage() {
        showPage('patternPage');
        initPatternCanvas();
        }

        function showResultsPage() {
        showPage('resultsPage');
        }

        function showFilterPage(type) {
        const pageMap = {
            revenue: 'revenuePage',
            pe: 'pePage',
            debt: 'debtPage',
            volume: 'volumePage',
            moving: 'movingPage'
        };
        if (pageMap[type]) showPage(pageMap[type]);
        else alert('Unknown filter: ' + type);
        }

        // STOCK MANAGEMENT
        function loadUserStocks() {
        const stockList = document.getElementById('stockList');
        stockList.innerHTML = '';
        userStocks.forEach(ticker => {
            const item = document.createElement('div');
            item.className = 'stock-item';
            item.innerHTML = `<h3>${ticker}</h3><p>Stock ticker: ${ticker}</p><button onclick="removeStock('${ticker}')">Remove</button>`;
            stockList.appendChild(item);
        });
        }

        function addStock() {
        const input = document.getElementById('newStock');
        const ticker = input.value.toUpperCase().trim();
        if (!ticker) return showMessage('stockMessage', 'Please enter a stock ticker', 'error');
        if (userStocks.includes(ticker)) return showMessage('stockMessage', 'Stock already in list', 'error');
        userStocks.push(ticker);
        input.value = '';
        showMessage('stockMessage', `${ticker} added`, 'success');
        loadUserStocks();
        }

        function removeStock(ticker) {
        userStocks = userStocks.filter(t => t !== ticker);
        showMessage('stockMessage', `${ticker} removed`, 'success');
        loadUserStocks();
        }

        // GRAPHS
        function loadGraphs() {
        const container = document.getElementById('graphsContainer');
        container.innerHTML = '<div class="loading">Loading graphs...<div class="spinner"></div></div>';
        setTimeout(() => {
            container.innerHTML = '';
            userStocks.forEach(ticker => {
            if (demoStockData[ticker]) createChart(ticker, demoStockData[ticker], container);
            else container.innerHTML += `<div class='chart-container'><h3>${ticker}</h3><p>No data available</p></div>`;
            });
        }, 1000);
        }

        function createChart(ticker, data, container) {
        const div = document.createElement('div');
        div.className = 'chart-container';
        const canvas = document.createElement('canvas');
        div.innerHTML = `<h3>${ticker} - 5 Year Performance</h3>`;
        div.appendChild(canvas);
        container.appendChild(div);
        const ctx = canvas.getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
            labels: data.map(d => d.date.getFullYear()),
            datasets: [{
                label: ticker,
                data: data.map(d => d.value),
                borderColor: '#00ff80',
                backgroundColor: 'rgba(0,255,128,0.1)',
                borderWidth: 2,
                fill: true
            }]
            },
            options: {
            responsive: true,
            plugins: { legend: { labels: { color: '#fff' } } },
            scales: {
                y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
            }
            }
        });
        }

        // PATTERN LOGIC
        function initPatternCanvas() {
        const canvas = document.getElementById('patternCanvas');
        const ctx = canvas.getContext('2d');
        canvas.addEventListener('click', addPatternPoint);
        drawGrid(ctx, canvas.width, canvas.height);
        }

        function drawGrid(ctx, width, height) {
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 1;
        for (let x = 0; x <= width; x += 50) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, height);
            ctx.stroke();
        }
        for (let y = 0; y <= height; y += 50) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(width, y);
            ctx.stroke();
        }
        }

        function addPatternPoint(event) {
        const canvas = document.getElementById('patternCanvas');
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        patternPoints.push({ x, y });
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#00ff80';
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.font = '12px Inter, Arial';
        ctx.fillText(patternPoints.length, x + 8, y - 8);
        }

        function connectPoints() {
        if (patternPoints.length < 2) return showMessage('patternMessage', 'Add at least 2 points to connect', 'error');
        const canvas = document.getElementById('patternCanvas');
        const ctx = canvas.getContext('2d');
        ctx.strokeStyle = '#00ff80';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(patternPoints[0].x, patternPoints[0].y);
        for (let i = 1; i < patternPoints.length; i++) {
            ctx.lineTo(patternPoints[i].x, patternPoints[i].y);
        }
        ctx.stroke();
        showMessage('patternMessage', 'Pattern created successfully!', 'success');
        }

        function clearPattern() {
        patternPoints = [];
        const canvas = document.getElementById('patternCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid(ctx, canvas.width, canvas.height);
        showMessage('patternMessage', 'Pattern cleared', 'success');
        }

        function analyzePattern() {
        if (patternPoints.length < 3) return showMessage('patternMessage', 'Create a pattern with at least 3 points', 'error');
        showMessage('patternMessage', 'Analyzing pattern...', 'success');
        setTimeout(() => {
            showResultsPage();
            loadPatternResults();
        }, 2000);
        }

        function loadPatternResults() {
        const container = document.getElementById('resultsContainer');
        container.innerHTML = '<div class="loading">Analyzing pattern matches...<div class="spinner"></div></div>';
        setTimeout(() => {
            container.innerHTML = '';
            const matches = [];
            const nonMatches = [];
            userStocks.forEach(ticker => {
            (Math.random() > 0.5 ? matches : nonMatches).push(ticker);
            });

            matches.forEach(ticker => {
            if (demoStockData[ticker]) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-item pattern-match';
                resultDiv.innerHTML = `<h3>${ticker} - PATTERN MATCH ✓</h3><p>Confidence: ${(80 + Math.random() * 20).toFixed(1)}%</p>`;
                const canvas = document.createElement('canvas');
                resultDiv.appendChild(canvas);
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                type: 'line',
                data: {
                    labels: demoStockData[ticker].slice(-12).map((_, i) => `M${i+1}`),
                    datasets: [{
                    label: ticker,
                    data: demoStockData[ticker].slice(-12).map(d => d.value),
                    borderColor: '#00ff80',
                    backgroundColor: 'rgba(0, 255, 128, 0.1)',
                    borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                    y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
                });
                container.appendChild(resultDiv);
            }
            });

            nonMatches.forEach(ticker => {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-item';
            resultDiv.innerHTML = `<h3>${ticker} - No Match</h3><p>Pattern similarity too low</p>`;
            container.appendChild(resultDiv);
            });

            if (matches.length === 0) {
            container.innerHTML = '<div class="error">No pattern matches found in your portfolio</div>';
            }
        }, 3000);
        }

        // UTIL
        function showMessage(id, message, type) {
        const el = document.getElementById(id);
        el.innerHTML = `<div class="${type}">${message}</div>`;
        setTimeout(() => el.innerHTML = '', 3000);
        }

        document.addEventListener('DOMContentLoaded', () => {
        showPage('loginPage');
        });
    </script>
</body>
</html>